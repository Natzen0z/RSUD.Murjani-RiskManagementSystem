<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Management System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Alpine.js for interactions -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <!-- ExcelJS & FileSaver for Export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        [x-cloak] { display: none !important; }
    </style>

    <!-- MAIN APP LOGIC -->
    <script>
        function riskApp() {
            return {
                activeTab: 'dashboard',
                isMobileMenuOpen: false,
                riskData: [],
                searchTerm: '',
                filterUnit: '', 
                
                // Period Settings
                periodType: 'Triwulan',
                periodValue: 'II',
                periodYear: '2024',
                globalPeriod: 'Triwulan II - 2024',

                // Daftar Unit Rumah Sakit
                units: [
                    'RSUD dr. Murjani',
                    'IGD',
                    'Rawat Jalan',
                    'Farmasi',
                    'Laboratorium',
                    'Radiologi',
                    'Gizi',
                    'Manajemen',
                    'K3RS'
                ],

                // New Risk Form State
                newRisk: {
                    risiko: '',
                    dampakDeskripsi: '',
                    kategori: 'Strategis',
                    unit: '', 
                    penyebab: '',
                    awalD: 1,
                    awalP: 1,
                    pengendalian: '',
                    evaluasi: 'Dibagi',
                    residualD: 1,
                    residualP: 1,
                    pj: '',
                    status: 'Not Started',
                    validasi: 'Menunggu',
                    validator: '' 
                },

                // Charts
                catChartInstance: null,
                statChartInstance: null,

                init() {
                    this.$watch('activeTab', (value) => {
                        if (value === 'dashboard') {
                            setTimeout(() => this.updateCharts(), 100);
                        }
                        setTimeout(() => {
                            if (window.lucide) window.lucide.createIcons();
                        }, 50);
                    });

                    this.$watch('riskData', () => {
                         if (this.activeTab === 'dashboard') {
                            this.updateCharts();
                         }
                         setTimeout(() => {
                            if (window.lucide) window.lucide.createIcons();
                        }, 50);
                    });

                    this.updatePeriod();
                    
                    setTimeout(() => {
                        if (window.lucide) window.lucide.createIcons();
                    }, 100);
                    
                    if (this.activeTab === 'dashboard') {
                        setTimeout(() => this.updateCharts(), 100);
                    }
                },

                setActiveTab(tab) {
                    this.activeTab = tab;
                },

                getHeaderTitle() {
                    if (this.activeTab === 'dashboard') return 'Dashboard Eksekutif';
                    if (this.activeTab === 'register') return 'Daftar Risiko & Validasi Unit';
                    if (this.activeTab === 'matrix') return 'Analisis Matriks Risiko';
                    if (this.activeTab === 'controls') return 'Pengendalian & Evaluasi';
                    return '';
                },

                updatePeriod() {
                    if (this.periodType === "Tahun") {
                        this.globalPeriod = `Tahun ${this.periodYear}`;
                    } else {
                        this.globalPeriod = `${this.periodType} ${this.periodValue} - ${this.periodYear}`;
                    }
                },

                calculateLevel(score) {
                    if (score >= 15) return 'Kritis';
                    if (score >= 10) return 'Tinggi';
                    if (score >= 5) return 'Sedang';
                    return 'Rendah';
                },

                getRiskColor(level) {
                    switch (level) {
                        case 'Kritis': return 'bg-red-600 text-white';
                        case 'Tinggi': return 'bg-orange-500 text-white';
                        case 'Sedang': return 'bg-yellow-400 text-black';
                        case 'Rendah': return 'bg-green-500 text-white';
                        default: return 'bg-slate-200 text-slate-800';
                    }
                },

                getStatusColor(status) {
                    switch (status) {
                        case 'Completed': return 'bg-emerald-100 text-emerald-800 border-emerald-200';
                        case 'In-Progress': return 'bg-blue-100 text-blue-800 border-blue-200';
                        case 'Not Started': return 'bg-gray-100 text-gray-800 border-gray-200';
                        default: return 'bg-gray-100 text-gray-800';
                    }
                },

                getValidationColor(status) {
                    switch (status) {
                        case 'Valid': return 'bg-teal-100 text-teal-800 border-teal-200';
                        case 'Revisi': return 'bg-red-100 text-red-800 border-red-200';
                        default: return 'bg-slate-100 text-slate-600 border-slate-200'; 
                    }
                },

                addRisk() {
                    if (!this.newRisk.risiko) {
                        alert("Uraian Risiko harus diisi!");
                        return;
                    }
                    if (!this.newRisk.unit) {
                        alert("Nama Unit harus diisi!");
                        return;
                    }

                    const awalSkor = (parseInt(this.newRisk.awalD) || 1) * (parseInt(this.newRisk.awalP) || 1);
                    const residualSkor = (parseInt(this.newRisk.residualD) || 1) * (parseInt(this.newRisk.residualP) || 1);

                    const riskEntry = {
                        id: `R-${String(this.riskData.length + 1).padStart(3, '0')}`,
                        risiko: this.newRisk.risiko,
                        dampakDeskripsi: this.newRisk.dampakDeskripsi,
                        kategori: this.newRisk.kategori,
                        unit: this.newRisk.unit,
                        penyebab: this.newRisk.penyebab,
                        awal: { 
                            d: parseInt(this.newRisk.awalD) || 1, 
                            p: parseInt(this.newRisk.awalP) || 1, 
                            skor: awalSkor, 
                            level: this.calculateLevel(awalSkor) 
                        },
                        residual: { 
                            d: parseInt(this.newRisk.residualD) || 1, 
                            p: parseInt(this.newRisk.residualP) || 1, 
                            skor: residualSkor, 
                            level: this.calculateLevel(residualSkor) 
                        },
                        evaluasi: this.newRisk.evaluasi,
                        pengendalian: this.newRisk.pengendalian,
                        pj: this.newRisk.pj,
                        status: this.newRisk.status,
                        validasi: 'Menunggu',
                        validator: '', 
                        triwulan: this.periodType === "Tahun" ? "Tahunan" : `${this.periodType} ${this.periodValue}`
                    };

                    this.riskData.push(riskEntry);

                    // Reset Form
                    this.newRisk.risiko = '';
                    this.newRisk.dampakDeskripsi = '';
                    this.newRisk.kategori = 'Strategis';
                    this.newRisk.penyebab = '';
                    this.newRisk.awalD = 1;
                    this.newRisk.awalP = 1;
                    this.newRisk.pengendalian = '';
                    this.newRisk.evaluasi = 'Dibagi';
                    this.newRisk.residualD = 1;
                    this.newRisk.residualP = 1;
                    this.newRisk.pj = '';
                    this.newRisk.status = 'Not Started';
                },

                deleteRisk(id) {
                    if(confirm("Hapus data risiko ini?")) {
                        this.riskData = this.riskData.filter(item => item.id !== id);
                    }
                },

                filteredData() {
                    return this.riskData.filter(item => {
                        const matchesSearch = (item.risiko && item.risiko.toLowerCase().includes(this.searchTerm.toLowerCase())) ||
                                            (item.kategori && item.kategori.toLowerCase().includes(this.searchTerm.toLowerCase()));
                        const matchesUnit = this.filterUnit === '' || (item.unit && item.unit.toLowerCase().includes(this.filterUnit.toLowerCase()));
                        return matchesSearch && matchesUnit;
                    });
                },

                getHighRiskCount() {
                    return this.riskData.filter(d => d.awal.level === 'Tinggi' || d.awal.level === 'Kritis').length;
                },

                getMatrixCount(p, d) {
                    return this.riskData.filter(item => item.awal.p === p && item.awal.d === d).length;
                },

                updateCharts() {
                    if (typeof Chart === 'undefined') return;

                    const canvasCat = document.getElementById('categoryChart');
                    const canvasStat = document.getElementById('statusChart');

                    if (!canvasCat || !canvasStat) return;

                    const counts = {};
                    this.riskData.forEach(d => {
                        counts[d.kategori] = (counts[d.kategori] || 0) + 1;
                    });
                    const catLabels = Object.keys(counts);
                    const catValues = Object.values(counts);

                    const completed = this.riskData.filter(d => d.status === 'Completed').length;
                    const active = this.riskData.filter(d => d.status === 'In-Progress').length;
                    const notStarted = this.riskData.length - completed - active;

                    const ctxCat = canvasCat.getContext('2d');
                    if (this.catChartInstance) {
                        this.catChartInstance.destroy();
                    }
                    
                    this.catChartInstance = new Chart(ctxCat, {
                        type: 'bar',
                        data: {
                            labels: catLabels.length > 0 ? catLabels : ['Belum ada data'],
                            datasets: [{
                                label: 'Jumlah Risiko',
                                data: catValues.length > 0 ? catValues : [0],
                                backgroundColor: '#0d9488',
                                borderRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { beginAtZero: true, ticks: { stepSize: 1 } },
                                x: { grid: { display: false } }
                            }
                        }
                    });

                    const ctxStat = canvasStat.getContext('2d');
                    if (this.statChartInstance) {
                        this.statChartInstance.destroy();
                    }

                    this.statChartInstance = new Chart(ctxStat, {
                        type: 'doughnut',
                        data: {
                            labels: ['Selesai', 'Berjalan', 'Belum Mulai'],
                            datasets: [{
                                data: this.riskData.length > 0 ? [completed, active, notStarted] : [0, 0, 1], 
                                backgroundColor: this.riskData.length > 0 ? ['#10b981', '#3b82f6', '#94a3b8'] : ['#e2e8f0', '#e2e8f0', '#e2e8f0']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                },

                async exportToExcel() {
                    if (this.riskData.length === 0) {
                        alert("Belum ada data untuk diekspor!");
                        return;
                    }

                    const workbook = new ExcelJS.Workbook();
                    workbook.creator = 'Risk Management System';
                    workbook.created = new Date();

                    // --- SHEET 1: DASHBOARD ---
                    const dashSheet = workbook.addWorksheet('Dashboard');
                    
                    // Styles
                    const titleStyle = { font: { size: 16, bold: true } };
                    const headerStyle = { font: { bold: true }, fill: { type: 'pattern', pattern:'solid', fgColor:{ argb:'FFEEEEEE' } } };

                    dashSheet.getCell('A1').value = 'DASHBOARD MANAJEMEN RISIKO';
                    dashSheet.getCell('A1').font = titleStyle;
                    dashSheet.getCell('A2').value = `Periode: ${this.globalPeriod}`;
                    dashSheet.getCell('A2').font = { italic: true };

                    // Summary Stats Table
                    dashSheet.getCell('A4').value = 'Ringkasan Statistik';
                    dashSheet.getCell('A4').font = { bold: true };
                    
                    const stats = [
                        ['Total Risiko', this.riskData.length],
                        ['Risiko Tinggi/Kritis', this.getHighRiskCount()],
                        ['Mitigasi Selesai', this.riskData.filter(r => r.status === 'Completed').length],
                        ['Mitigasi Berjalan', this.riskData.filter(r => r.status === 'In-Progress').length]
                    ];

                    stats.forEach((stat, index) => {
                        dashSheet.getCell(`A${5 + index}`).value = stat[0];
                        dashSheet.getCell(`B${5 + index}`).value = stat[1];
                    });

                    // Export Charts as Images
                    const canvasCat = document.getElementById('categoryChart');
                    const canvasStat = document.getElementById('statusChart');

                    if (canvasCat && canvasStat) {
                        const catImgBase64 = canvasCat.toDataURL('image/png');
                        const statImgBase64 = canvasStat.toDataURL('image/png');

                        const catImageId = workbook.addImage({ base64: catImgBase64, extension: 'png' });
                        const statImageId = workbook.addImage({ base64: statImgBase64, extension: 'png' });

                        dashSheet.addImage(catImageId, {
                            tl: { col: 3, row: 4 },
                            ext: { width: 400, height: 250 }
                        });

                        dashSheet.addImage(statImageId, {
                            tl: { col: 8, row: 4 },
                            ext: { width: 400, height: 250 }
                        });
                    } else {
                        dashSheet.getCell('D5').value = "(Grafik tidak tersedia saat ekspor - pastikan Anda berada di tab Dashboard saat mengunduh)";
                    }

                    // --- SHEET 2: RISK REGISTER ---
                    const regSheet = workbook.addWorksheet('Risk Register');
                    regSheet.getCell('A1').value = 'DAFTAR RISIKO TERINTEGRASI';
                    regSheet.getCell('A1').font = titleStyle;

                    // Headers
                    const headers = [
                        'Kode', 'Unit', 'Kategori', 'Risiko', 'Penyebab', 'Dampak', 
                        'Dampak (Skor)', 'Prob (Skor)', 'Skor Awal', 'Level Awal',
                        'Pengendalian', 'Evaluasi', 
                        'Dampak (Sisa)', 'Prob (Sisa)', 'Skor Sisa', 'Level Sisa',
                        'PJ', 'Status', 'Validasi', 'Validator'
                    ];
                    
                    regSheet.getRow(3).values = headers;
                    regSheet.getRow(3).font = { bold: true, color: { argb: 'FFFFFFFF' } };
                    regSheet.getRow(3).fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF0D9488' } }; // Teal color

                    this.riskData.forEach(item => {
                        regSheet.addRow([
                            item.id, item.unit, item.kategori, item.risiko, item.penyebab, item.dampakDeskripsi,
                            item.awal.d, item.awal.p, item.awal.skor, item.awal.level,
                            item.pengendalian, item.evaluasi,
                            item.residual.d, item.residual.p, item.residual.skor, item.residual.level,
                            item.pj, item.status, item.validasi, item.validator
                        ]);
                    });

                    // Auto width for some columns
                    regSheet.columns.forEach(column => { column.width = 15; });
                    regSheet.getColumn(4).width = 30; // Risiko
                    regSheet.getColumn(5).width = 25; // Penyebab
                    regSheet.getColumn(11).width = 30; // Pengendalian

                    // --- SHEET 3: MATRIX ---
                    const matSheet = workbook.addWorksheet('Matriks Risiko');
                    matSheet.getCell('A1').value = 'MATRIKS ANALISIS RISIKO';
                    matSheet.getCell('A1').font = titleStyle;

                    // Simple 5x5 Grid Representation
                    // Header Cols (Impact)
                    for(let i=1; i<=5; i++) {
                        matSheet.getCell(3, i + 2).value = `Dampak ${i}`;
                        matSheet.getCell(3, i + 2).font = { bold: true };
                        matSheet.getCell(3, i + 2).alignment = { horizontal: 'center' };
                    }
                    // Header Rows (Prob)
                    for(let i=5; i>=1; i--) {
                        matSheet.getCell(9 - i, 2).value = `Prob ${i}`;
                        matSheet.getCell(9 - i, 2).font = { bold: true };
                    }

                    // Fill Data and Colors
                    const colors = {
                        'Rendah': 'FF4ADE80', // Green
                        'Sedang': 'FFFACC15', // Yellow
                        'Tinggi': 'FFF97316', // Orange
                        'Kritis': 'FFDC2626'  // Red
                    };

                    for(let p=5; p>=1; p--) { // Row
                        for(let d=1; d<=5; d++) { // Col
                            const count = this.getMatrixCount(p, d);
                            const score = p * d;
                            const level = this.calculateLevel(score);
                            const cell = matSheet.getCell(9 - p, d + 2);
                            
                            cell.value = count > 0 ? count : '';
                            cell.fill = {
                                type: 'pattern',
                                pattern: 'solid',
                                fgColor: { argb: colors[level] }
                            };
                            cell.alignment = { horizontal: 'center', vertical: 'middle' };
                            cell.border = { top: {style:'thin'}, left: {style:'thin'}, bottom: {style:'thin'}, right: {style:'thin'} };
                        }
                    }

                    // --- SHEET 4: CONTROLS ---
                    const ctrlSheet = workbook.addWorksheet('Pengendalian (Gap)');
                    ctrlSheet.getCell('A1').value = 'GAP ANALYSIS & PENGENDALIAN';
                    ctrlSheet.getCell('A1').font = titleStyle;

                    ctrlSheet.getRow(3).values = ['Kode', 'Risiko', 'Pengendalian Saat Ini', 'Target Waktu', 'Status', 'PJ'];
                    ctrlSheet.getRow(3).font = { bold: true };

                    const activeRisks = this.riskData.filter(r => r.status !== 'Completed');
                    activeRisks.forEach(item => {
                        ctrlSheet.addRow([
                            item.id, item.risiko, item.pengendalian, item.triwulan, item.status, item.pj
                        ]);
                    });
                    ctrlSheet.getColumn(2).width = 40;
                    ctrlSheet.getColumn(3).width = 40;

                    // GENERATE FILE
                    const buffer = await workbook.xlsx.writeBuffer();
                    saveAs(new Blob([buffer]), `Risk_Register_${this.periodYear}_${new Date().getTime()}.xlsx`);
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 font-sans text-slate-900" x-data="riskApp()">

    <!-- MOBILE HEADER -->
    <div class="md:hidden fixed top-0 w-full bg-slate-900 text-white z-50 px-4 py-3 flex justify-between items-center shadow-md">
        <div class="flex items-center space-x-2">
            <i data-lucide="activity" class="w-6 h-6 text-teal-400"></i>
            <span class="font-bold">Risk Management</span>
        </div>
        <button @click="isMobileMenuOpen = !isMobileMenuOpen">
            <i data-lucide="menu" class="w-6 h-6 text-white"></i>
        </button>
    </div>

    <!-- MOBILE MENU DROPDOWN -->
    <div x-show="isMobileMenuOpen" x-cloak class="md:hidden fixed top-14 left-0 w-full bg-slate-800 text-white z-40 p-4 space-y-2 shadow-xl transition-all">
        <button @click="setActiveTab('dashboard'); isMobileMenuOpen = false" class="block w-full text-left py-2 px-4 hover:bg-slate-700 rounded">Dashboard</button>
        <button @click="setActiveTab('register'); isMobileMenuOpen = false" class="block w-full text-left py-2 px-4 hover:bg-slate-700 rounded">Daftar Risiko</button>
        <button @click="setActiveTab('matrix'); isMobileMenuOpen = false" class="block w-full text-left py-2 px-4 hover:bg-slate-700 rounded">Matriks Risiko</button>
        <button @click="setActiveTab('controls'); isMobileMenuOpen = false" class="block w-full text-left py-2 px-4 hover:bg-slate-700 rounded">Pengendalian</button>
    </div>

    <!-- SIDEBAR (DESKTOP) -->
    <div class="w-64 bg-slate-900 text-white h-screen fixed left-0 top-0 p-4 flex flex-col shadow-xl z-50 hidden md:flex">
        <div class="mb-8 flex items-center space-x-2 px-2">
            <i data-lucide="activity" class="w-8 h-8 text-teal-400"></i>
            <div>
                <h1 class="text-xl font-bold tracking-tight">Risk Management</h1>
                <p class="text-xs text-slate-400">RSUD dr. Murjani</p>
            </div>
        </div>
        
        <nav class="flex-1 space-y-2">
            <button @click="setActiveTab('dashboard')" :class="activeTab === 'dashboard' ? 'bg-teal-600 text-white shadow-lg shadow-teal-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                <span class="font-medium">Dashboard</span>
            </button>
            <button @click="setActiveTab('register')" :class="activeTab === 'register' ? 'bg-teal-600 text-white shadow-lg shadow-teal-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200">
                <i data-lucide="file-text" class="w-5 h-5"></i>
                <span class="font-medium">Daftar Risiko</span>
            </button>
            <button @click="setActiveTab('matrix')" :class="activeTab === 'matrix' ? 'bg-teal-600 text-white shadow-lg shadow-teal-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200">
                <i data-lucide="target" class="w-5 h-5"></i>
                <span class="font-medium">Matriks Risiko</span>
            </button>
            <button @click="setActiveTab('controls')" :class="activeTab === 'controls' ? 'bg-teal-600 text-white shadow-lg shadow-teal-900/50' : 'text-slate-400 hover:bg-slate-800 hover:text-white'" class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200">
                <i data-lucide="shield-check" class="w-5 h-5"></i>
                <span class="font-medium">Pengendalian</span>
            </button>
        </nav>

        <div class="mt-auto space-y-4">
            <!-- EXPORT BUTTON -->
            <button @click="exportToExcel()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-3 px-4 rounded-xl flex items-center justify-center font-semibold shadow-lg shadow-emerald-900/20 transition-all">
                <i data-lucide="file-spreadsheet" class="w-5 h-5 mr-2"></i>
                <span>Download Excel</span>
            </button>

            <div class="px-4 py-4 bg-slate-800 rounded-xl border border-slate-700">
                <div class="flex items-center mb-2 text-teal-400">
                   <i data-lucide="calendar" class="w-4 h-4 mr-2"></i>
                   <p class="text-xs font-semibold uppercase tracking-wider">Periode Laporan</p>
                </div>
                <p class="font-bold text-sm text-white" x-text="globalPeriod"></p>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main class="flex-1 md:ml-64 p-4 md:p-8 mt-14 md:mt-0 transition-all duration-300 ease-in-out">
        
        <!-- HEADER -->
        <header class="mb-8 flex justify-between items-center">
            <div>
               <h1 class="text-2xl md:text-3xl font-bold text-slate-800" x-text="getHeaderTitle()"></h1>
               <p class="text-slate-500 mt-1">Sistem Manajemen Risiko RSUD dr. Murjani</p>
            </div>
        </header>

        <!-- 1. DASHBOARD VIEW -->
        <div x-show="activeTab === 'dashboard'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform scale-95" x-transition:enter-end="opacity-100 transform scale-100">
            
            <!-- Empty State -->
            <div x-show="riskData.length === 0" class="flex flex-col items-center justify-center h-96 text-center bg-white rounded-2xl border border-slate-200 border-dashed p-8">
                <i data-lucide="file-text" class="w-16 h-16 text-slate-300 mb-4"></i>
                <h3 class="text-lg font-bold text-slate-700">Belum Ada Data Risiko</h3>
                <p class="text-slate-500 max-w-md">Silakan masuk ke menu "Daftar Risiko" untuk mulai menambahkan data risiko secara manual.</p>
            </div>

            <!-- Stats & Charts -->
            <div x-show="riskData.length > 0" class="space-y-6">
                <!-- Stat Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- Total -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between hover:-translate-y-1 transition-transform">
                        <div>
                            <p class="text-sm font-medium text-slate-500 mb-1">Total Risiko</p>
                            <h3 class="text-3xl font-bold text-slate-800" x-text="riskData.length"></h3>
                        </div>
                        <div class="p-3 rounded-xl bg-blue-500 bg-opacity-10 text-blue-600">
                            <i data-lucide="file-text" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <!-- Kritis/Tinggi -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between hover:-translate-y-1 transition-transform">
                        <div>
                            <p class="text-sm font-medium text-slate-500 mb-1">Risiko Tinggi/Kritis</p>
                            <h3 class="text-3xl font-bold text-slate-800" x-text="getHighRiskCount()"></h3>
                        </div>
                        <div class="p-3 rounded-xl bg-red-500 bg-opacity-10 text-red-600">
                            <i data-lucide="alert-octagon" class="w-6 h-6"></i>
                        </div>
                    </div>
                     <!-- Selesai -->
                     <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between hover:-translate-y-1 transition-transform">
                        <div>
                            <p class="text-sm font-medium text-slate-500 mb-1">Mitigasi Selesai</p>
                            <h3 class="text-3xl font-bold text-slate-800" x-text="riskData.filter(r => r.status === 'Completed').length"></h3>
                        </div>
                        <div class="p-3 rounded-xl bg-emerald-500 bg-opacity-10 text-emerald-600">
                            <i data-lucide="check-circle" class="w-6 h-6"></i>
                        </div>
                    </div>
                     <!-- Berjalan -->
                     <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between hover:-translate-y-1 transition-transform">
                        <div>
                            <p class="text-sm font-medium text-slate-500 mb-1">Mitigasi Berjalan</p>
                            <h3 class="text-3xl font-bold text-slate-800" x-text="riskData.filter(r => r.status === 'In-Progress').length"></h3>
                        </div>
                        <div class="p-3 rounded-xl bg-amber-500 bg-opacity-10 text-amber-600">
                            <i data-lucide="clock" class="w-6 h-6"></i>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Bar Chart -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <i data-lucide="bar-chart-2" class="w-5 h-5 mr-2 text-teal-600"></i>
                            Distribusi Kategori Risiko
                        </h3>
                        <div class="h-64">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                    <!-- Pie Chart -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                            <i data-lucide="activity" class="w-5 h-5 mr-2 text-teal-600"></i>
                            Status Mitigasi
                        </h3>
                        <div class="h-64 flex justify-center">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. REGISTER VIEW -->
        <div x-show="activeTab === 'register'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0">
            
            <!-- Period Settings -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-5 mb-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="flex items-center gap-4">
                    <div class="p-3 bg-indigo-50 text-indigo-600 rounded-xl">
                        <i data-lucide="calendar" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800">Pengaturan Periode Laporan</h3>
                        <p class="text-sm text-slate-500">Tentukan periode laporan dokumen ini.</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <select x-model="periodType" @change="updatePeriod()" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm font-medium">
                        <option value="Triwulan">Triwulan</option>
                        <option value="Semester">Semester</option>
                        <option value="Tahun">Tahun</option>
                    </select>
                    <select x-show="periodType !== 'Tahun'" x-model="periodValue" @change="updatePeriod()" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm font-medium">
                        <template x-if="periodType === 'Triwulan'">
                            <optgroup>
                                <option value="I">I (Jan-Mar)</option>
                                <option value="II">II (Apr-Jun)</option>
                                <option value="III">III (Jul-Sep)</option>
                                <option value="IV">IV (Okt-Des)</option>
                            </optgroup>
                        </template>
                        <template x-if="periodType === 'Semester'">
                            <optgroup>
                                <option value="I">I (Jan-Jun)</option>
                                <option value="II">II (Jul-Des)</option>
                            </optgroup>
                        </template>
                    </select>
                    <select x-model="periodYear" @change="updatePeriod()" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm font-medium">
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
            </div>

            <!-- Input Form -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6 mb-6">
                <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center">
                    <i data-lucide="plus" class="w-5 h-5 mr-2 text-teal-600"></i>
                    Input Risiko Baru
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-12 gap-4 text-sm">
                    <!-- Column 1 -->
                    <div class="md:col-span-3 space-y-3">
                        <div>
                            <label class="block text-slate-500 mb-1">Unit/Bagian</label>
                            <!-- UNIT MENJADI INPUT TEXT MANUAL -->
                            <input type="text" x-model="newRisk.unit" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500" placeholder="Ketik nama unit...">
                        </div>
                        <div>
                            <label class="block text-slate-500 mb-1">Risiko</label>
                            <textarea x-model="newRisk.risiko" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-teal-500" rows="2" placeholder="Contoh: Pasien Kabur"></textarea>
                        </div>
                        <div>
                            <label class="block text-slate-500 mb-1">Deskripsi Dampak</label>
                            <textarea x-model="newRisk.dampakDeskripsi" class="w-full p-2 border rounded-lg" rows="2" placeholder="Uraian dampak..."></textarea>
                        </div>
                        <div>
                            <label class="block text-slate-500 mb-1">Kategori</label>
                            <select x-model="newRisk.kategori" class="w-full p-2 border rounded-lg">
                                <option>Strategis</option>
                                <option>Operasional</option>
                                <option>Fraud</option>
                                <option>Hukum</option>
                                <option>Keuangan</option>
                                <option>SDM</option>
                                <option>Teknologi Informasi</option>
                                <option>Klinis</option>
                                <option>HAZARD</option>
                            </select>
                        </div>
                    </div>
                    <!-- Column 2 -->
                    <div class="md:col-span-3 space-y-3">
                        <div>
                            <label class="block text-slate-500 mb-1">Penyebab</label>
                            <textarea x-model="newRisk.penyebab" class="w-full p-2 border rounded-lg" rows="2" placeholder="Penyebab utama..."></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-2 bg-slate-50 p-2 rounded-lg border border-slate-200">
                            <div class="text-center font-semibold text-xs col-span-2 mb-1 text-slate-600">SKOR AWAL</div>
                            <div>
                                <label class="text-xs text-slate-400 block">Dampak (1-5)</label>
                                <input type="number" min="1" max="5" x-model="newRisk.awalD" class="w-full p-1 border rounded text-center">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block">Prob (1-5)</label>
                                <input type="number" min="1" max="5" x-model="newRisk.awalP" class="w-full p-1 border rounded text-center">
                            </div>
                            <div class="col-span-2 text-center text-xs font-bold text-teal-600 mt-1">
                                Skor: <span x-text="(newRisk.awalD || 1) * (newRisk.awalP || 1)"></span> (<span x-text="calculateLevel((newRisk.awalD || 1) * (newRisk.awalP || 1))"></span>)
                            </div>
                        </div>
                    </div>
                    <!-- Column 3 -->
                    <div class="md:col-span-3 space-y-3">
                        <div>
                            <label class="block text-slate-500 mb-1">Rencana Pengendalian</label>
                            <textarea x-model="newRisk.pengendalian" class="w-full p-2 border rounded-lg" rows="2" placeholder="Tindakan mitigasi..."></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-2 bg-slate-50 p-2 rounded-lg border border-slate-200">
                            <div class="text-center font-semibold text-xs col-span-2 mb-1 text-slate-600">SKOR RESIDUAL</div>
                            <div>
                                <label class="text-xs text-slate-400 block">Dampak</label>
                                <input type="number" min="1" max="5" x-model="newRisk.residualD" class="w-full p-1 border rounded text-center">
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block">Prob</label>
                                <input type="number" min="1" max="5" x-model="newRisk.residualP" class="w-full p-1 border rounded text-center">
                            </div>
                            <div class="col-span-2 text-center text-xs font-bold text-teal-600 mt-1">
                                Skor: <span x-text="(newRisk.residualD || 1) * (newRisk.residualP || 1)"></span> (<span x-text="calculateLevel((newRisk.residualD || 1) * (newRisk.residualP || 1))"></span>)
                            </div>
                        </div>
                    </div>
                    <!-- Column 4 -->
                    <div class="md:col-span-3 space-y-3 flex flex-col justify-between">
                         <div>
                            <label class="block text-slate-500 mb-1">PJ (Penanggung Jawab)</label>
                            <input type="text" x-model="newRisk.pj" class="w-full p-2 border rounded-lg" placeholder="Nama/Jabatan">
                        </div>
                        <div>
                            <label class="block text-slate-500 mb-1">Status</label>
                            <select x-model="newRisk.status" class="w-full p-2 border rounded-lg">
                                <option value="Not Started">Belum Mulai</option>
                                <option value="In-Progress">Berjalan</option>
                                <option value="Completed">Selesai</option>
                            </select>
                        </div>
                        <button @click="addRisk()" class="w-full bg-teal-600 hover:bg-teal-700 text-white py-2 px-4 rounded-lg flex items-center justify-center font-semibold transition-colors mt-2">
                            <i data-lucide="save" class="w-4 h-4 mr-2"></i>
                            Simpan Risiko
                        </button>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div>
                        <h2 class="text-xl font-bold text-slate-800">Daftar Risiko & Validasi</h2>
                        <div class="flex items-center mt-2">
                            <span class="text-sm text-slate-500 mr-2">Filter Unit:</span>
                            <!-- FILTER UNIT MANUAL -->
                            <input type="text" x-model="filterUnit" class="p-1 text-sm bg-slate-50 border border-slate-200 rounded text-slate-700 w-40 focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Ketik unit...">
                        </div>
                    </div>
                    <div class="relative w-full md:w-72">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                        <input x-model="searchTerm" type="text" placeholder="Cari risiko..." class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm">
                    </div>
                </div>

                <div x-show="riskData.length === 0" class="p-12 text-center text-slate-400">
                    Belum ada data yang tersimpan. Gunakan formulir di atas untuk menambahkan risiko.
                </div>

                <div x-show="riskData.length > 0" class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-slate-50 text-slate-600 font-semibold uppercase tracking-wider">
                            <tr>
                                <th class="px-4 py-4 w-20">Kode</th>
                                <th class="px-4 py-4 w-32">Unit & Kategori</th>
                                <th class="px-4 py-4 w-64">Risiko, Penyebab & Dampak</th>
                                <th class="px-4 py-4 w-24 text-center">Skor Awal</th>
                                <th class="px-4 py-4 w-48">Pengendalian</th>
                                <th class="px-4 py-4 w-24 text-center">Skor Sisa</th>
                                <th class="px-4 py-4 w-32">PJ & Status</th>
                                <th class="px-4 py-4 w-40 text-center bg-indigo-50 text-indigo-700 border-l border-indigo-100">Validasi Unit</th>
                                <th class="px-4 py-4 w-32 text-center bg-indigo-50 text-indigo-700 border-l border-indigo-100">Validator</th>
                                <th class="px-4 py-4 w-16 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <template x-for="item in filteredData()" :key="item.id">
                                <tr class="hover:bg-slate-50 transition-colors">
                                    <td class="px-4 py-4 font-medium text-slate-900 align-top" x-text="item.id"></td>
                                    <td class="px-4 py-4 align-top">
                                        <div class="font-bold text-slate-700" x-text="item.unit"></div>
                                        <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-600 mt-1" x-text="item.kategori"></span>
                                    </td>
                                    <td class="px-4 py-4 align-top">
                                        <div class="font-bold text-slate-800 mb-1" x-text="item.risiko"></div>
                                        <div class="text-xs text-slate-500 mb-1"><span class="font-semibold">Penyebab:</span> <span x-text="item.penyebab"></span></div>
                                        <div class="text-xs text-slate-500" x-show="item.dampakDeskripsi"><span class="font-semibold">Dampak:</span> <span x-text="item.dampakDeskripsi"></span></div>
                                    </td>
                                    <td class="px-4 py-4 text-center align-top">
                                        <div class="flex flex-col items-center gap-1">
                                            <span class="px-2 py-1 rounded text-xs font-bold" :class="getRiskColor(item.awal.level)" x-text="item.awal.skor"></span>
                                            <div class="text-xs text-slate-400" x-text="item.awal.level"></div>
                                        </div>
                                    </td>
                                    <td class="px-4 py-4 align-top">
                                        <div class="text-slate-700 mb-2 text-xs" x-text="item.pengendalian"></div>
                                    </td>
                                    <td class="px-4 py-4 text-center align-top">
                                        <div class="flex flex-col items-center gap-1">
                                            <span class="px-2 py-1 rounded text-xs font-bold" :class="getRiskColor(item.residual.level)" x-text="item.residual.skor"></span>
                                            <div class="text-xs text-slate-400" x-text="item.residual.level"></div>
                                        </div>
                                    </td>
                                    <td class="px-4 py-4 align-top">
                                        <div class="text-slate-900 font-medium mb-1 text-xs" x-text="item.pj"></div>
                                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-medium border" :class="getStatusColor(item.status)" x-text="item.status"></span>
                                    </td>
                                    <!-- Kolom Validasi -->
                                    <td class="px-4 py-4 text-center align-top border-l border-slate-100 bg-slate-50/50">
                                        <select x-model="item.validasi" 
                                            class="w-full text-xs p-1 rounded border cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-300"
                                            :class="getValidationColor(item.validasi)">
                                            <option value="Menunggu">Menunggu</option>
                                            <option value="Valid">Valid</option>
                                            <option value="Revisi">Revisi</option>
                                        </select>
                                        <div x-show="item.validasi === 'Valid'" class="mt-1 text-[10px] text-teal-600 flex items-center justify-center gap-1">
                                            <i data-lucide="check-check" class="w-3 h-3"></i> Terverifikasi
                                        </div>
                                    </td>
                                    <!-- Kolom Validator -->
                                    <td class="px-4 py-4 text-center align-top border-l border-slate-100 bg-slate-50/50">
                                        <input type="text" x-model="item.validator" class="w-full text-xs p-1 rounded border focus:outline-none focus:ring-2 focus:ring-indigo-300" placeholder="Nama Validator">
                                    </td>
                                    <td class="px-4 py-4 text-center align-top">
                                        <button @click="deleteRisk(item.id)" class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 3. MATRIX VIEW -->
        <div x-show="activeTab === 'matrix'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100">
            <div class="bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
                <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center">
                    <i data-lucide="target" class="w-6 h-6 mr-2 text-teal-600"></i>
                    Peta Panas Risiko (Risk Heatmap)
                </h2>

                <div x-show="riskData.length === 0" class="text-center py-12 text-slate-400 border-2 border-dashed border-slate-200 rounded-xl">
                    Belum ada data untuk dipetakan.
                </div>

                <div x-show="riskData.length > 0">
                    <div class="flex flex-col items-center overflow-x-auto">
                        <div class="flex items-center">
                            <!-- Y Axis Label -->
                            <div class="-rotate-90 font-bold text-slate-500 tracking-wider text-sm w-8 text-center mr-4">PROBABILITAS</div>
                            
                            <!-- Y Labels -->
                            <div class="grid grid-rows-5 gap-1">
                                <div class="h-20 flex items-center justify-end pr-2 font-semibold text-slate-400 text-sm">Sgt Tinggi</div>
                                <div class="h-20 flex items-center justify-end pr-2 font-semibold text-slate-400 text-sm">Tinggi</div>
                                <div class="h-20 flex items-center justify-end pr-2 font-semibold text-slate-400 text-sm">Sedang</div>
                                <div class="h-20 flex items-center justify-end pr-2 font-semibold text-slate-400 text-sm">Rendah</div>
                                <div class="h-20 flex items-center justify-end pr-2 font-semibold text-slate-400 text-sm">Sgt Rendah</div>
                            </div>

                            <!-- The Matrix Grid -->
                            <div class="grid grid-cols-5 grid-rows-5 gap-2 ml-2">
                                <!-- Row 5 (Prob 5) -->
                                <div class="w-24 h-20 bg-yellow-400 rounded-lg flex items-center justify-center relative shadow-sm" title="P:5 D:1">
                                    <span x-text="getMatrixCount(5,1)" x-show="getMatrixCount(5,1) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:5 D:2">
                                    <span x-text="getMatrixCount(5,2)" x-show="getMatrixCount(5,2) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:5 D:3">
                                    <span x-text="getMatrixCount(5,3)" x-show="getMatrixCount(5,3) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-red-600 rounded-lg flex items-center justify-center relative shadow-sm" title="P:5 D:4">
                                    <span x-text="getMatrixCount(5,4)" x-show="getMatrixCount(5,4) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-red-600 rounded-lg flex items-center justify-center relative shadow-sm" title="P:5 D:5">
                                    <span x-text="getMatrixCount(5,5)" x-show="getMatrixCount(5,5) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>

                                <!-- Row 4 (Prob 4) -->
                                <div class="w-24 h-20 bg-yellow-400 rounded-lg flex items-center justify-center relative shadow-sm" title="P:4 D:1">
                                    <span x-text="getMatrixCount(4,1)" x-show="getMatrixCount(4,1) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:4 D:2">
                                    <span x-text="getMatrixCount(4,2)" x-show="getMatrixCount(4,2) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:4 D:3">
                                    <span x-text="getMatrixCount(4,3)" x-show="getMatrixCount(4,3) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-red-600 rounded-lg flex items-center justify-center relative shadow-sm" title="P:4 D:4">
                                    <span x-text="getMatrixCount(4,4)" x-show="getMatrixCount(4,4) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-red-600 rounded-lg flex items-center justify-center relative shadow-sm" title="P:4 D:5">
                                    <span x-text="getMatrixCount(4,5)" x-show="getMatrixCount(4,5) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>

                                <!-- Row 3 (Prob 3) -->
                                <div class="w-24 h-20 bg-green-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:3 D:1">
                                    <span x-text="getMatrixCount(3,1)" x-show="getMatrixCount(3,1) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-yellow-400 rounded-lg flex items-center justify-center relative shadow-sm" title="P:3 D:2">
                                    <span x-text="getMatrixCount(3,2)" x-show="getMatrixCount(3,2) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:3 D:3">
                                    <span x-text="getMatrixCount(3,3)" x-show="getMatrixCount(3,3) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-red-600 rounded-lg flex items-center justify-center relative shadow-sm" title="P:3 D:4">
                                    <span x-text="getMatrixCount(3,4)" x-show="getMatrixCount(3,4) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-red-600 rounded-lg flex items-center justify-center relative shadow-sm" title="P:3 D:5">
                                    <span x-text="getMatrixCount(3,5)" x-show="getMatrixCount(3,5) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>

                                <!-- Row 2 (Prob 2) -->
                                <div class="w-24 h-20 bg-green-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:2 D:1">
                                    <span x-text="getMatrixCount(2,1)" x-show="getMatrixCount(2,1) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-green-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:2 D:2">
                                    <span x-text="getMatrixCount(2,2)" x-show="getMatrixCount(2,2) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-yellow-400 rounded-lg flex items-center justify-center relative shadow-sm" title="P:2 D:3">
                                    <span x-text="getMatrixCount(2,3)" x-show="getMatrixCount(2,3) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:2 D:4">
                                    <span x-text="getMatrixCount(2,4)" x-show="getMatrixCount(2,4) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:2 D:5">
                                    <span x-text="getMatrixCount(2,5)" x-show="getMatrixCount(2,5) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>

                                <!-- Row 1 (Prob 1) -->
                                <div class="w-24 h-20 bg-green-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:1 D:1">
                                    <span x-text="getMatrixCount(1,1)" x-show="getMatrixCount(1,1) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-green-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:1 D:2">
                                    <span x-text="getMatrixCount(1,2)" x-show="getMatrixCount(1,2) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-yellow-400 rounded-lg flex items-center justify-center relative shadow-sm" title="P:1 D:3">
                                    <span x-text="getMatrixCount(1,3)" x-show="getMatrixCount(1,3) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-yellow-400 rounded-lg flex items-center justify-center relative shadow-sm" title="P:1 D:4">
                                    <span x-text="getMatrixCount(1,4)" x-show="getMatrixCount(1,4) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                                <div class="w-24 h-20 bg-orange-500 rounded-lg flex items-center justify-center relative shadow-sm" title="P:1 D:5">
                                    <span x-text="getMatrixCount(1,5)" x-show="getMatrixCount(1,5) > 0" class="text-2xl font-bold text-white drop-shadow-md"></span>
                                </div>
                            </div>
                        </div>

                         <!-- X Axis -->
                         <div class="flex mt-2 ml-24">
                            <div class="w-24 text-center pt-2 font-semibold text-slate-400 text-sm">Sgt Ringan</div>
                            <div class="w-24 text-center pt-2 font-semibold text-slate-400 text-sm">Ringan</div>
                            <div class="w-24 text-center pt-2 font-semibold text-slate-400 text-sm">Sedang</div>
                            <div class="w-24 text-center pt-2 font-semibold text-slate-400 text-sm">Berat</div>
                            <div class="w-24 text-center pt-2 font-semibold text-slate-400 text-sm">Sgt Berat</div>
                        </div>
                        <div class="mt-2 font-bold text-slate-500 tracking-wider text-sm ml-24">DAMPAK</div>
                    </div>
                    
                    <div class="mt-8 grid grid-cols-4 gap-4 max-w-2xl mx-auto">
                        <div class="flex items-center"><div class="w-4 h-4 bg-green-500 rounded mr-2"></div> <span class="text-sm text-slate-600">Rendah (1-4)</span></div>
                        <div class="flex items-center"><div class="w-4 h-4 bg-yellow-400 rounded mr-2"></div> <span class="text-sm text-slate-600">Sedang (5-9)</span></div>
                        <div class="flex items-center"><div class="w-4 h-4 bg-orange-500 rounded mr-2"></div> <span class="text-sm text-slate-600">Tinggi (10-14)</span></div>
                        <div class="flex items-center"><div class="w-4 h-4 bg-red-600 rounded mr-2"></div> <span class="text-sm text-slate-600">Kritis (15-25)</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. CONTROLS VIEW -->
        <div x-show="activeTab === 'controls'" x-transition:enter="transition ease-out duration-300">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-8">
                <div class="flex items-center mb-6 text-amber-600 bg-amber-50 p-4 rounded-xl border border-amber-100">
                   <i data-lucide="alert-triangle" class="w-6 h-6 mr-3"></i>
                   <div>
                     <h3 class="font-bold">Modul Pengendalian</h3>
                     <p class="text-sm text-amber-800">Modul ini akan aktif setelah Anda mengisi data risiko pada menu Daftar Risiko.</p>
                   </div>
                </div>

                <div x-show="riskData.length > 0">
                    <h3 class="font-bold text-lg mb-4">Rencana Tindak Lanjut (Gap Analysis)</h3>
                    <div class="space-y-4">
                        <template x-for="item in riskData.filter(r => r.status !== 'Completed')" :key="item.id">
                            <div class="border border-slate-200 rounded-xl p-4 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start mb-2">
                                  <div>
                                      <span class="inline-block px-2 py-0.5 bg-slate-100 text-slate-600 text-xs rounded mb-1" x-text="item.unit"></span>
                                      <h4 class="font-bold text-slate-800" x-text="item.risiko"></h4>
                                  </div>
                                  <span class="text-xs font-semibold px-2 py-1 bg-slate-100 rounded text-slate-600" x-text="'Target: ' + item.triwulan"></span>
                                </div>
                                <div class="grid md:grid-cols-2 gap-4 text-sm mt-3">
                                  <div>
                                      <p class="text-xs text-slate-400 uppercase font-semibold mb-1">Pengendalian Saat Ini</p>
                                      <p class="text-slate-700 bg-green-50 p-2 rounded border border-green-100" x-text="item.pengendalian || '-'"></p>
                                  </div>
                                  <div>
                                      <p class="text-xs text-slate-400 uppercase font-semibold mb-1">Status</p>
                                      <p class="text-slate-700 bg-blue-50 p-2 rounded border border-blue-100" x-text="item.status + ' - PJ: ' + item.pj"></p>
                                  </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

    </main>
</body>
</html>